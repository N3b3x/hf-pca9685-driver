<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HF-PCA9685: Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HF-PCA9685<span id="projectnumber">&#160;0.1.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Configuration</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md28"></a> This guide covers all configuration options available for the PCA9685 driver.</p>
<h1><a class="anchor" id="autotoc_md29"></a>
I2C Address Configuration</h1>
<p>The PCA9685 I2C address is configured via hardware pins A0-A5. Each pin represents one bit of the 6-bit address field.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Pin   </th><th class="markdownTableHeadNone">Address Bit   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">A0   </td><td class="markdownTableBodyNone">Bit 0   </td><td class="markdownTableBodyNone">Least significant address bit    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">A1   </td><td class="markdownTableBodyNone">Bit 1   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">A2   </td><td class="markdownTableBodyNone">Bit 2   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">A3   </td><td class="markdownTableBodyNone">Bit 3   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">A4   </td><td class="markdownTableBodyNone">Bit 4   </td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">A5   </td><td class="markdownTableBodyNone">Bit 5   </td><td class="markdownTableBodyNone">Most significant address bit   </td></tr>
</table>
<p><b>Default I2C address</b>: <code>0x40</code> (all address pins to GND)</p>
<p><b>Address Range</b>: 0x40 to 0x7F (7-bit I2C addresses)</p>
<p><b>Example</b>: To set address 0x41, connect A0 to VDD and A1-A5 to GND.</p>
<h1><a class="anchor" id="autotoc_md30"></a>
PWM Frequency Configuration</h1>
<h2><a class="anchor" id="autotoc_md31"></a>
Setting Frequency</h2>
<p>Use the <code>SetPwmFreq()</code> method to configure the PWM frequency:</p>
<div class="fragment"><div class="line">pwm.SetPwmFreq(50.0f); <span class="comment">// 50 Hz for servos</span></div>
<div class="line">pwm.SetPwmFreq(1000.0f); <span class="comment">// 1 kHz for LEDs</span></div>
</div><!-- fragment --><p><b>Valid Range</b>: 24 Hz to 1526 Hz (typical)</p>
<p><b>Location</b>: <a href="../src/pca9685.cpp#L46"><code>src/pca9685.cpp#L46</code></a></p>
<h2><a class="anchor" id="autotoc_md32"></a>
Frequency Calculation</h2>
<p>The driver automatically calculates the prescale value using the formula:</p>
<div class="fragment"><div class="line">prescale = round(25,000,000 / (4096 * freq_hz)) - 1</div>
</div><!-- fragment --><p>Where:</p><ul>
<li><code>25,000,000</code> is the internal oscillator frequency (25 MHz)</li>
<li><code>4096</code> is the PWM resolution (12 bits)</li>
<li><code>freq_hz</code> is the desired frequency</li>
</ul>
<p><b>Implementation</b>: <a href="../src/pca9685.cpp#L168"><code>src/pca9685.cpp#L168</code></a></p>
<h2><a class="anchor" id="autotoc_md33"></a>
Common Frequencies</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Application   </th><th class="markdownTableHeadNone">Frequency   </th><th class="markdownTableHeadNone">Prescale (approx)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Servos   </td><td class="markdownTableBodyNone">50 Hz   </td><td class="markdownTableBodyNone">121    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">LEDs (smooth dimming)   </td><td class="markdownTableBodyNone">1000 Hz   </td><td class="markdownTableBodyNone">5    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Motors   </td><td class="markdownTableBodyNone">100-500 Hz   </td><td class="markdownTableBodyNone">11-61   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md34"></a>
Channel Configuration</h1>
<h2><a class="anchor" id="autotoc_md35"></a>
Individual Channel Control</h2>
<p>Set PWM for a single channel:</p>
<div class="fragment"><div class="line"><span class="comment">// Set channel 0: on at tick 0, off at tick 2048 (50% duty)</span></div>
<div class="line">pwm.SetPwm(0, 0, 2048);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set duty cycle (0.0 = off, 1.0 = fully on)</span></div>
<div class="line">pwm.SetDuty(0, 0.5f); <span class="comment">// 50% duty</span></div>
</div><!-- fragment --><p><b>Channel Range</b>: 0-15 (16 channels total)</p>
<p><b>PWM Value Range</b>: 0-4095 (12-bit resolution)</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Bulk Channel Control</h2>
<p>Set all channels simultaneously:</p>
<div class="fragment"><div class="line"><span class="comment">// Set all channels to same PWM value</span></div>
<div class="line">pwm.SetAllPwm(0, 2048); <span class="comment">// All channels at 50% duty</span></div>
</div><!-- fragment --><p><b>Use Case</b>: Synchronized control of all outputs</p>
<h1><a class="anchor" id="autotoc_md37"></a>
Register Map Reference</h1>
<p>The driver abstracts register access, but understanding the register map helps with advanced usage:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Register   </th><th class="markdownTableHeadNone">Address   </th><th class="markdownTableHeadNone">Purpose    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>MODE1</code>   </td><td class="markdownTableBodyNone">0x00   </td><td class="markdownTableBodyNone">Main configuration (reset, sleep, auto-increment)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>MODE2</code>   </td><td class="markdownTableBodyNone">0x01   </td><td class="markdownTableBodyNone">Output configuration (open-drain, totem-pole, inversion)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>SUBADR1-3</code>   </td><td class="markdownTableBodyNone">0x02-0x04   </td><td class="markdownTableBodyNone">Subaddress registers    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ALLCALLADR</code>   </td><td class="markdownTableBodyNone">0x05   </td><td class="markdownTableBodyNone">All-call I2C address    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>LED0_ON_L</code>   </td><td class="markdownTableBodyNone">0x06   </td><td class="markdownTableBodyNone">Channel 0 ON time (low byte)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>LED0_ON_H</code>   </td><td class="markdownTableBodyNone">0x07   </td><td class="markdownTableBodyNone">Channel 0 ON time (high byte)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>LED0_OFF_L</code>   </td><td class="markdownTableBodyNone">0x08   </td><td class="markdownTableBodyNone">Channel 0 OFF time (low byte)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>LED0_OFF_H</code>   </td><td class="markdownTableBodyNone">0x09   </td><td class="markdownTableBodyNone">Channel 0 OFF time (high byte)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">...   </td><td class="markdownTableBodyNone">...   </td><td class="markdownTableBodyNone">Channels 1-15 follow sequentially    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ALL_LED_ON_L</code>   </td><td class="markdownTableBodyNone">0xFA   </td><td class="markdownTableBodyNone">All channels ON time (low byte)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ALL_LED_ON_H</code>   </td><td class="markdownTableBodyNone">0xFB   </td><td class="markdownTableBodyNone">All channels ON time (high byte)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>ALL_LED_OFF_L</code>   </td><td class="markdownTableBodyNone">0xFC   </td><td class="markdownTableBodyNone">All channels OFF time (low byte)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>ALL_LED_OFF_H</code>   </td><td class="markdownTableBodyNone">0xFD   </td><td class="markdownTableBodyNone">All channels OFF time (high byte)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>PRE_SCALE</code>   </td><td class="markdownTableBodyNone">0xFE   </td><td class="markdownTableBodyNone">PWM frequency prescaler    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>TESTMODE</code>   </td><td class="markdownTableBodyNone">0xFF   </td><td class="markdownTableBodyNone">Test mode register   </td></tr>
</table>
<p><b>Register Definitions</b>: <a href="../inc/pca9685.hpp#L139"><code>inc/pca9685.hpp#L139</code></a></p>
<h1><a class="anchor" id="autotoc_md38"></a>
Advanced Features</h1>
<h2><a class="anchor" id="autotoc_md39"></a>
Output Enable (OE) Pin</h2>
<p>The OE pin provides hardware control over all outputs:</p><ul>
<li><b>HIGH</b>: All outputs disabled (high-impedance)</li>
<li><b>LOW/Floating</b>: All outputs enabled</li>
</ul>
<p><b>Note</b>: The driver does not control the OE pin. You must handle it externally via GPIO if needed.</p>
<h2><a class="anchor" id="autotoc_md40"></a>
Sleep Mode</h2>
<p>The chip supports sleep mode for power saving. The driver handles sleep mode automatically when changing frequency (see <code>SetPwmFreq()</code> implementation).</p>
<h2><a class="anchor" id="autotoc_md41"></a>
Auto-Increment</h2>
<p>The chip supports auto-increment for efficient register access. The driver uses this feature internally for multi-byte writes.</p>
<h1><a class="anchor" id="autotoc_md42"></a>
Runtime Configuration</h1>
<h2><a class="anchor" id="autotoc_md43"></a>
Initialization Sequence</h2>
<ol type="1">
<li><b>Reset</b>: Call <code>Reset()</code> to put device in known state</li>
<li><b>Set Frequency</b>: Call <code>SetPwmFreq()</code> before setting channels</li>
<li><b>Configure Channels</b>: Use <code>SetPwm()</code> or <code>SetDuty()</code> to control outputs</li>
</ol>
<p><b>Example</b>: </p><div class="fragment"><div class="line">pwm.Reset();              <span class="comment">// Initialize</span></div>
<div class="line">pwm.SetPwmFreq(50.0f);   <span class="comment">// Set frequency</span></div>
<div class="line">pwm.SetDuty(0, 0.5f);    <span class="comment">// Configure channel</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md44"></a>
Recommended Settings</h1>
<h2><a class="anchor" id="autotoc_md45"></a>
For Servo Control</h2>
<div class="fragment"><div class="line">pwm.Reset();</div>
<div class="line">pwm.SetPwmFreq(50.0f); <span class="comment">// Standard servo frequency</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set servo to center position (1.5ms pulse)</span></div>
<div class="line">pwm.SetDuty(0, 0.075f); <span class="comment">// 7.5% duty = 1.5ms / 20ms</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md46"></a>
For LED Dimming</h2>
<div class="fragment"><div class="line">pwm.Reset();</div>
<div class="line">pwm.SetPwmFreq(1000.0f); <span class="comment">// High frequency for smooth dimming</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Fade LED on channel 0</span></div>
<div class="line"><span class="keywordflow">for</span> (<span class="keywordtype">float</span> duty = 0.0f; duty &lt;= 1.0f; duty += 0.01f) {</div>
<div class="line">    pwm.SetDuty(0, duty);</div>
<div class="line">    delay(10);</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md47"></a>
For Motor Control</h2>
<div class="fragment"><div class="line">pwm.Reset();</div>
<div class="line">pwm.SetPwmFreq(200.0f); <span class="comment">// Moderate frequency for motors</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Set motor speed</span></div>
<div class="line">pwm.SetDuty(0, 0.75f); <span class="comment">// 75% speed</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md48"></a>
Next Steps</h1>
<ul>
<li>See <a class="el" href="md_docs_2examples.html">Examples</a> for configuration examples</li>
<li>Review <a class="el" href="md_docs_2api__reference.html">API Reference</a> for all configuration methods</li>
<li>Check <a class="el" href="md_docs_2troubleshooting.html">Troubleshooting</a> for configuration issues </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
